{% extends 'base.html' %}
{% block content %}
<div class="max-w-5xl mx-auto bg-white rounded-xl shadow-md p-8 mt-6">
  <h1 class="text-3xl font-bold text-purple-600 mb-6">Order Details</h1>

  <!-- Order Info -->
  <div class="grid md:grid-cols-2 gap-6 mb-6">
    <div class="space-y-2">
      <p><strong>Order ID:</strong> {{ order.id }}</p>
      <p><strong>Customer:</strong> {{ order.full_name }}</p>
      <p><strong>Email:</strong> {{ order.user.email }}</p>
      <p><strong>Phone:</strong> {{ order.phone }}</p>
    </div>
    <div class="space-y-2">
      <p><strong>Payment:</strong> {{ order.payment_method|title }}</p>
      <p><strong>Amount:</strong> â‚¹{{ order.total }}</p>
      <p><strong>Placed:</strong> {{ order.created_at|date:"M d, Y - h:i A" }}</p>
      <p><strong>Status:</strong> 
        <span class="px-2 py-1 rounded text-sm {% if order.status == 'Delivered' %}bg-green-100 text-green-700{% elif order.status == 'Processing' %}bg-blue-100 text-blue-700{% elif order.status == 'Cancelled' %}bg-red-100 text-red-700{% else %}bg-gray-100 text-gray-700{% endif %}">
          {{ order.status }}
        </span>
      </p>
    </div>
  </div>

  <!-- Shipping Info -->
  <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-8">
    <h2 class="text-lg font-semibold text-gray-800 mb-2">ðŸ“¦ Shipping Address</h2>
    <p>{{ order.address_line1 }}</p>
    {% if order.address_line2 %}<p>{{ order.address_line2 }}</p>{% endif %}
    <p>{{ order.city }}, {{ order.state }} - {{ order.postal_code }}</p>
    <p>{{ order.country }}</p>
  </div>

  <!-- Ordered Items -->
  <div>
    <h2 class="text-lg font-semibold text-gray-800 mb-4">ðŸ§¾ Ordered Items</h2>
    <table class="min-w-full border border-gray-200 text-sm">
      <thead class="bg-purple-100">
        <tr class="text-gray-700 text-left">
          <th class="py-2 px-3 border-b">Product</th>
          <th class="py-2 px-3 border-b text-center">Qty</th>
          <th class="py-2 px-3 border-b text-right">Price (â‚¹)</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order.items.all %}
        <tr class="hover:bg-gray-50">
          <td class="py-2 px-3 border-b">{{ item.product.name }}</td>
          <td class="py-2 px-3 border-b text-center">{{ item.quantity }}</td>
          <td class="py-2 px-3 border-b text-right">{{ item.price }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot class="bg-gray-50">
        <tr>
          <td colspan="2" class="py-2 px-3 text-right font-semibold">Total:</td>
          <td class="py-2 px-3 text-right text-purple-600 font-bold">â‚¹{{ order.total }}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Update Section -->
  <form method="POST" class="mt-8 space-y-4">
    {% csrf_token %}
    <div>
      <label class="block font-medium text-gray-700 mb-1">Change Status:</label>
      <select name="status" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500">
        <option value="">-- Select Status --</option>
        <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
        <option value="Processing" {% if order.status == 'Processing' %}selected{% endif %}>Processing</option>
        <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
        <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
        <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
      </select>
    </div>

    <div>
      <label class="block font-medium text-gray-700 mb-1">Admin Notes:</label>
      <textarea name="admin_notes" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500" placeholder="Add internal notes...">{{ order.admin_notes }}</textarea>
    </div>

    <div class="flex justify-end gap-3">
      <a href="{% url 'orders:admin_orders' %}" class="px-5 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition">Back</a>
      <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition shadow">Update Order</button>
    </div>
  </form>
</div>

<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
div {
  animation: fadeIn 0.4s ease-in-out;
}
</style>
{% endblock %}
